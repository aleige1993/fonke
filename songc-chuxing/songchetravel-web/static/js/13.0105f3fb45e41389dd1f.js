webpackJsonp([13],{1018:function(e,t,r){var a=r(17)(r(876),r(1019),null,null,null);e.exports=a.exports},1019:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"el-form fl el-form--inline"},["circle"!=e.showtype?r("div",{staticClass:"el-form-item"},[r("label",{staticClass:"el-form-item__label",staticStyle:{width:"60px"},attrs:{for:"name"}},[e._v(e._s(e.radiusLabel))]),e._v(" "),r("div",{staticClass:"el-form-item__content",staticStyle:{"margin-left":"10px"}},[r("div",{staticClass:"el-input el-input-group el-input-group--append"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.subradius,expression:"subradius"}],staticClass:"el-input__inner",attrs:{autocomplete:"off",type:"text",name:"name",rows:"2",maxlength:"24",validateevent:"true"},domProps:{value:e.subradius},on:{input:[function(t){t.target.composing||(e.subradius=t.target.value)},e.changeradius]}}),e._v(" "),e._m(0)])])]):e._e(),e._v(" "),"circle"!=e.showtype?r("div",{staticClass:"el-form-item"},[r("label",{staticClass:"el-form-item__label",staticStyle:{width:"60px"},attrs:{for:"name"}},[e._v("搜索城市")]),e._v(" "),r("div",{staticClass:"el-form-item__content",staticStyle:{"margin-left":"10px"}},[r("div",{staticClass:"el-input el-input-group el-input-group--append"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.keyword,expression:"keyword"}],staticClass:"el-input__inner",attrs:{autocomplete:"off",type:"text",name:"name",rows:"2",maxlength:"24",validateevent:"true"},domProps:{value:e.keyword},on:{input:function(t){t.target.composing||(e.keyword=t.target.value)}}}),e._v(" "),r("div",{staticClass:"el-input-group__append"},[r("button",{staticClass:"el-button el-button--primary",attrs:{type:"button"},on:{click:e.schCity}},[r("span",[e._v("搜索")])])])])])]):e._e()]),e._v(" "),"polyon"===e.showtype?r("el-alert",{attrs:{title:"画多边形请务必双击闭合,可进入编辑模式;右键可以清除所画多边形",type:"success"}}):e._e(),e._v(" "),r("div",{style:e.mapStyle,attrs:{id:"mapimpl"}})],1)},staticRenderFns:[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"el-input-group__append"},[r("span",[e._v("米")])])}]}},1096:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(298),n=a(o),i=r(853),l=a(i),s=r(852),c=a(s),d=r(856),u=a(d),p=r(1018),f=a(p),m=r(295),h=a(m);t.default={data:function(){var e=this;return{isShow:!0,isEdit:!1,filterData:[{key:"name",type:"input",placeholder:"名称"}],filterParams:{name:""},tableList:[{key:"name",value:"名称"},{key:"address",value:"百度地址"},{key:"radius",value:"半径(单位:米)"},{key:"isactive",value:"是否激活使用",type:"boolean",icon:["&#xe6b3;","&#xe63d;"],name:["否","是"],color:["red","green"]}],opreat:[{type:"edit",name:"编辑",roles:!1,click:function(t,r){e.goEdit(t,r)}},{type:"edit",name:"预览围栏",roles:!0,click:function(t,r){e.goView(t,r)}},{type:"delete",name:"删除",roles:!1,click:function(t,r){e.handleDelete(t,r)}}],keyword:{},pageParams:{rows:15,page:1},detialDic:[{key:"create_time",value:"创建时间"}],title:"电子围栏",addFormVisible:!1,editFormVisible:!1,mapVisible:!1,formLabelWidth:"90px",optType:"",optName:"",formAdd:{name:"",lng:"",lat:"",radius:"",isactive:"",vids:"",vmArr:[],levelArr:[]},ruleAdd:{name:[{required:!0,message:"请输入必填项",trigger:"blur"}],lng:[{required:!0,message:"请输入必填项",trigger:"blur"}],lat:[{required:!0,message:"请输入必填项",trigger:"blur"}],radius:[{required:!0,message:"请输入必填项",trigger:"blur"}]},formSch:{name:""},levelcodeOptions:[],carOptions:[],schLevelcodeOptions:[],roleData:[],pageIndex:1,pageSize:20,total:0,tableData:[],roles:{},addLoading:!1}},directives:{focus:{inserted:function(e,t){t.value&&(console.log("focus"),e.focus())}}},components:{mp:f.default},created:function(){},mounted:function(){this.$nextTick(function(){var e=this;this.getData(),this.$store.dispatch("checkApi",["/sys/org/querySelfAndChildren"]).then(function(t){t[0]?e.getLevelcodeOptions():console.log("“/sys/org/querySelfAndChildren”接口无权限")}),this.rolesMethod()})},methods:{rolesMethod:function(){var e=this;e.$store.dispatch("checkApi",["/car/fence/add","/car/fence/update","/car/fence/delete"]).then(function(t){e.roles={add:t[0]},e.opreat[0].roles=t[1],e.opreat[2].roles=t[2]})},pageChange:function(e,t){this.pageParams.rows=e,this.pageParams.page=t,this.getData()},getLevelcodeOptions:function(){var e=this;u.default.post(h.default+"/sys/org/querySelfAndChildren",{},function(t){e.levelcodeOptions.length=0,e.levelcodeOptions=t.entity},function(){},this)},handleLevelChange:function(e){var t=e[e.length-1];console.log("handleLevelChange:"+t),this.getCarData(t),this.carOptions.length=0},getCarData:function(e,t){var r=this,a=c.default.stringify({levelCode:e});u.default.post(h.default+"/car/vehicle/list",a,function(e){e.entity&&(r.carOptions=e.entity.list?e.entity.list:[],console.log("that.carOptions:::"+(0,l.default)(r.carOptions)),"function"==typeof t&&t())},function(){},this)},search:function(){this.keyword={};var e=["rows","page"];for(var t in this.filterParams)this.filterParams[t]&&e.indexOf(t)<0&&(this.keyword[t]=this.filterParams[t]);this.getData()},getData:function(e){var t=this,r=c.default.stringify((0,n.default)(t.pageParams,t.filterParams));u.default.post(h.default+"/car/fence/list",r,function(e){t.tableData=e.entity?e.entity.list:[],t.total=e.entity?e.entity.totalRow:0},function(){},this)},handleDelete:function(e,t){var r=this,a=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){u.default.post(h.default+"/car/fence/delete",c.default.stringify({fenceid:t.fenceid}),function(){a.$message({type:"success",message:"删除成功!"}),r.getData()},function(){},r)}).catch(function(){r.$message({type:"info",message:"已取消删除"})})},goMap:function(){this.mapVisible=!0;var e=this;this.$refs.map&&e.$refs.map.remark(this.formAdd.lng,this.formAdd.lat,this.formAdd.radius)},cancelMap:function(){this.mapVisible=!1,this.isShow=!0},add:function(){this.optType="add",this.optName="添加",this.addFormVisible=!0,this.isEdit=!1,this.resetForm(),this.$refs.formAdd&&this.$refs.formAdd.resetFields()},handleAdd:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;console.log("success submit!!"),t.addSave()})},handleMap:function(e,t){this.formAdd.lng=e.lng+"",this.formAdd.lat=e.lat+"",this.formAdd.radius=e.radius+""},addSave:function(){var e=this,t="";e.addLoading=!0,"add"==this.optType?(delete this.formAdd.fenceid,t=h.default+"/car/fence/add"):t=h.default+"/car/fence/update";var r=JSON.parse((0,l.default)(this.formAdd));r.vids=r.vmArr.join(","),r.levelArr=r.levelArr[r.levelArr.length-1],u.default.post(t,c.default.stringify(r),function(){e.addLoading=!1,e.$message({type:"info",message:"保存成功"}),e.$refs.formAdd&&e.$refs.formAdd.resetFields(),e.addFormVisible=!1,e.getData()},function(){e.addLoading=!1},this)},goCancelAdd:function(){this.addFormVisible=!1,this.$refs.formAdd&&this.$refs.formAdd.resetFields()},goView:function(e,t){this.goEdit(e,t),this.addFormVisible=!1,this.isShow=!1,this.goMap()},goEdit:function(e,t){var r=this;this.optType="edit",this.optName="编辑",this.addFormVisible=!0,this.isEdit=!0,this.resetForm(),this.$refs.formAdd&&this.$refs.formAdd.resetFields();for(var a in t)this.formAdd[a]="number"==typeof t[a]?t[a]+"":t[a];this.formAdd.levelArr=this.levelcodeToArray(t.levelcode),this.formAdd.vmArr=[],this.getCarData(t.levelcode,function(){if(!t.fencevehicles)return!1;for(var e in t.fencevehicles)r.formAdd.vmArr.push(t.fencevehicles[e].vehicleid);console.log("this.formAdd.vmArr:"+(0,l.default)(r.formAdd.vmArr))})},resetForm:function(){this.formAdd={name:"",lng:"",lat:"",radius:"",isactive:"",vids:"",vmArr:[],levelArr:[]}},levelcodeToArray:function(e){if(!e)return[];var t=e.split("/"),r=[];return t.length=t.length-1,t.length>0&&t.forEach(function(e){r.push(r[r.length-1]?r[r.length-1]+e+"/":e+"/")}),r}}}},1165:function(e,t,r){t=e.exports=r(843)(!1),t.push([e.i,".electic .stack-wrap .iconfont{font-size:22px;margin-right:5px;position:relative;top:3px}.electic .stack-wrap.stacktrue,.electic .stack-wrap.stacktrue .iconfont{color:#00a854}.electic .stack-wrap.stackfalse,.electic .stack-wrap.stackfalse .iconfont{color:#f04134}",""])},1201:function(e,t,r){var a=r(1165);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r(844)("0f59a146",a,!0,{})},1250:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"electic"},[r("m-filter",{attrs:{data:e.filterData,form:e.filterParams,add:e.roles.add},on:{search:e.search,add:e.add}}),e._v(" "),r("m-table",{attrs:{tableData:e.tableData,labelWidth:"130px",showOther:!1,opreatWidth:170,tableList:e.tableList,localName:"electric_table",otherList:e.detialDic,keyword:e.keyword,opreat:e.opreat,total:e.total},on:{pageChange:e.pageChange}}),e._v(" "),r("el-dialog",{attrs:{visible:e.addFormVisible,"before-close":e.goCancelAdd},on:{"update:visible":function(t){e.addFormVisible=t}}},[r("h2",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[r("i",{staticClass:"iconfont c-yellow",domProps:{innerHTML:e._s("添加"===e.optName?"&#xe624;":"&#xe606;")}}),e._v(e._s(e.optName))]),e._v(" "),r("el-form",{ref:"formAdd",attrs:{model:e.formAdd,rules:e.ruleAdd}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"名称","label-width":e.formLabelWidth,prop:"name"}},[r("el-input",{attrs:{type:"text","auto-complete":"off",name:"name","max-length":"24"},model:{value:e.formAdd.name,callback:function(t){e.$set(e.formAdd,"name",t)},expression:"formAdd.name"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"经度","label-width":e.formLabelWidth,prop:"lng"}},[r("el-input",{attrs:{type:"text","auto-complete":"off",name:"lng"},on:{focus:e.goMap},model:{value:e.formAdd.lng,callback:function(t){e.$set(e.formAdd,"lng",t)},expression:"formAdd.lng"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"纬度","label-width":e.formLabelWidth,prop:"lat"}},[r("el-input",{attrs:{type:"text","auto-complete":"off",name:"lat"},on:{focus:e.goMap,change:e.handleMap},model:{value:e.formAdd.lat,callback:function(t){e.$set(e.formAdd,"lat",t)},expression:"formAdd.lat"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"半径","label-width":e.formLabelWidth,prop:"radius"}},[r("el-input",{attrs:{type:"text","auto-complete":"off",name:"radius"},model:{value:e.formAdd.radius,callback:function(t){e.$set(e.formAdd,"radius",t)},expression:"formAdd.radius"}},[r("template",{slot:"append"},[e._v("\n                米\n              ")])],2)],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"所属部门","label-width":e.formLabelWidth,"change-on-select":"",prop:"levelcode"}},[r("div",{staticClass:"el-form-item__content"},[r("el-cascader",{attrs:{disabled:e.isEdit,options:e.levelcodeOptions,placeholder:"所属部门","change-on-select":""},on:{change:e.handleLevelChange},model:{value:e.formAdd.levelArr,callback:function(t){e.$set(e.formAdd,"levelArr",t)},expression:"formAdd.levelArr"}})],1)])],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"是否激活使用","label-width":e.formLabelWidth,prop:"isactive"}},[r("el-switch",{attrs:{"on-color":"#13ce66","off-color":"#ff4949","on-text":"是","off-text":"否"},model:{value:e.formAdd.isactive,callback:function(t){e.$set(e.formAdd,"isactive",t)},expression:"formAdd.isactive"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"请选择车辆","label-width":e.formLabelWidth,"change-on-select":"",prop:"vids"}},[r("el-select",{attrs:{multiple:"",filterable:"","allow-create":"",placeholder:"请选择车辆"},model:{value:e.formAdd.vmArr,callback:function(t){e.$set(e.formAdd,"vmArr",t)},expression:"formAdd.vmArr"}},e._l(e.carOptions,function(e){return r("el-option",{key:e.vehicleid,attrs:{label:e.platenumber,value:e.vehicleid,name:"vids"}})}))],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.goCancelAdd()}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.addLoading},on:{click:function(t){e.handleAdd("formAdd")}}},[e._v("确 定")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"",visible:e.mapVisible,"before-close":e.cancelMap},on:{"update:visible":function(t){e.mapVisible=t}}},[r("div",{attrs:{id:"js_mapwrap"}},[r("mp",{ref:"map",attrs:{longitude:e.formAdd.lng,radius:e.formAdd.radius,showtype:"click",latitude:e.formAdd.lat,description:e.formAdd.city,distance:e.formAdd.distance,radiusLabel:"围栏半径"},on:{change:e.handleMap}})],1),e._v(" "),e.isShow?r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.cancelMap()}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.cancelMap()}}},[e._v("确 定")])],1):e._e()])],1)},staticRenderFns:[]}},310:function(e,t,r){function a(e){r(1201)}var o=r(17)(r(1096),r(1250),a,null,null);e.exports=o.exports},849:function(e,t,r){"use strict";var a=String.prototype.replace,o=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return a.call(e,o,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},850:function(e,t,r){"use strict";var a=Object.prototype.hasOwnProperty,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),n=function(e){for(var t;e.length;){var r=e.pop();if(t=r.obj[r.prop],Array.isArray(t)){for(var a=[],o=0;o<t.length;++o)void 0!==t[o]&&a.push(t[o]);r.obj[r.prop]=a}}return t},i=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},a=0;a<e.length;++a)void 0!==e[a]&&(r[a]=e[a]);return r},l=function e(t,r,o){if(!r)return t;if("object"!=typeof r){if(Array.isArray(t))t.push(r);else{if("object"!=typeof t)return[t,r];(o.plainObjects||o.allowPrototypes||!a.call(Object.prototype,r))&&(t[r]=!0)}return t}if("object"!=typeof t)return[t].concat(r);var n=t;return Array.isArray(t)&&!Array.isArray(r)&&(n=i(t,o)),Array.isArray(t)&&Array.isArray(r)?(r.forEach(function(r,n){a.call(t,n)?t[n]&&"object"==typeof t[n]?t[n]=e(t[n],r,o):t.push(r):t[n]=r}),t):Object.keys(r).reduce(function(t,n){var i=r[n];return a.call(t,n)?t[n]=e(t[n],i,o):t[n]=i,t},n)},s=function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},c=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},d=function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),r="",a=0;a<t.length;++a){var n=t.charCodeAt(a);45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122?r+=t.charAt(a):n<128?r+=o[n]:n<2048?r+=o[192|n>>6]+o[128|63&n]:n<55296||n>=57344?r+=o[224|n>>12]+o[128|n>>6&63]+o[128|63&n]:(a+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(a)),r+=o[240|n>>18]+o[128|n>>12&63]+o[128|n>>6&63]+o[128|63&n])}return r},u=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],a=0;a<t.length;++a)for(var o=t[a],i=o.obj[o.prop],l=Object.keys(i),s=0;s<l.length;++s){var c=l[s],d=i[c];"object"==typeof d&&null!==d&&-1===r.indexOf(d)&&(t.push({obj:i,prop:c}),r.push(d))}return n(t)},p=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},f=function(e){return null!==e&&void 0!==e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))};e.exports={arrayToObject:i,assign:s,compact:u,decode:c,encode:d,isBuffer:f,isRegExp:p,merge:l}},852:function(e,t,r){"use strict";var a=r(858),o=r(857),n=r(849);e.exports={formats:n,parse:o,stringify:a}},853:function(e,t,r){e.exports={default:r(855),__esModule:!0}},855:function(e,t,r){var a=r(26);e.exports=function(e){return(a.JSON&&a.JSON.stringify||JSON.stringify).apply(JSON,arguments)}},856:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(297),n=a(o),i=r(852),l=(a(i),r(107));n.default.defaults.withCredentials=!0,t.default={post:function(e,t,r,a,o){var i=o;n.default.post(e,t).then(function(e){var t=e.data?e.data:{};if("string"==typeof t)try{t=JSON.parse(t)}catch(e){console.log("json parse error")}return t.result&&0==t.result.resultCode?"function"==typeof r?void r.call(i,t):void 0:t.result&&3==t.result.resultCode?(i.$message.error(t.result.resultMessage),void l.MessageBox.confirm("你已被登出，可以取消继续留在该页面，或者重新登录","确定登出",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then(function(){location.reload()})):("function"==typeof a&&a.call(i,t),void i.$message.error(t.result.resultMessage))}).catch(function(e){console.log("catch:"+e),i.$message.error("网络出错")})}}},857:function(e,t,r){"use strict";var a=r(850),o=Object.prototype.hasOwnProperty,n={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:a.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},i=function(e,t){for(var r={},a=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,i=t.parameterLimit===1/0?void 0:t.parameterLimit,l=a.split(t.delimiter,i),s=0;s<l.length;++s){var c,d,u=l[s],p=u.indexOf("]="),f=-1===p?u.indexOf("="):p+1;-1===f?(c=t.decoder(u,n.decoder),d=t.strictNullHandling?null:""):(c=t.decoder(u.slice(0,f),n.decoder),d=t.decoder(u.slice(f+1),n.decoder)),o.call(r,c)?r[c]=[].concat(r[c]).concat(d):r[c]=d}return r},l=function(e,t,r){for(var a=t,o=e.length-1;o>=0;--o){var n,i=e[o];if("[]"===i)n=[],n=n.concat(a);else{n=r.plainObjects?Object.create(null):{};var l="["===i.charAt(0)&&"]"===i.charAt(i.length-1)?i.slice(1,-1):i,s=parseInt(l,10);!isNaN(s)&&i!==l&&String(s)===l&&s>=0&&r.parseArrays&&s<=r.arrayLimit?(n=[],n[s]=a):n[l]=a}a=n}return a},s=function(e,t,r){if(e){var a=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,n=/(\[[^[\]]*])/,i=/(\[[^[\]]*])/g,s=n.exec(a),c=s?a.slice(0,s.index):a,d=[];if(c){if(!r.plainObjects&&o.call(Object.prototype,c)&&!r.allowPrototypes)return;d.push(c)}for(var u=0;null!==(s=i.exec(a))&&u<r.depth;){if(u+=1,!r.plainObjects&&o.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;d.push(s[1])}return s&&d.push("["+a.slice(s.index)+"]"),l(d,t,r)}};e.exports=function(e,t){var r=t?a.assign({},t):{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.ignoreQueryPrefix=!0===r.ignoreQueryPrefix,r.delimiter="string"==typeof r.delimiter||a.isRegExp(r.delimiter)?r.delimiter:n.delimiter,r.depth="number"==typeof r.depth?r.depth:n.depth,r.arrayLimit="number"==typeof r.arrayLimit?r.arrayLimit:n.arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder="function"==typeof r.decoder?r.decoder:n.decoder,r.allowDots="boolean"==typeof r.allowDots?r.allowDots:n.allowDots,r.plainObjects="boolean"==typeof r.plainObjects?r.plainObjects:n.plainObjects,r.allowPrototypes="boolean"==typeof r.allowPrototypes?r.allowPrototypes:n.allowPrototypes,r.parameterLimit="number"==typeof r.parameterLimit?r.parameterLimit:n.parameterLimit,r.strictNullHandling="boolean"==typeof r.strictNullHandling?r.strictNullHandling:n.strictNullHandling,""===e||null===e||void 0===e)return r.plainObjects?Object.create(null):{};for(var o="string"==typeof e?i(e,r):e,l=r.plainObjects?Object.create(null):{},c=Object.keys(o),d=0;d<c.length;++d){var u=c[d],p=s(u,o[u],r);l=a.merge(l,p,r)}return a.compact(l)}},858:function(e,t,r){"use strict";var a=r(850),o=r(849),n={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},i=Date.prototype.toISOString,l={delimiter:"&",encode:!0,encoder:a.encode,encodeValuesOnly:!1,serializeDate:function(e){return i.call(e)},skipNulls:!1,strictNullHandling:!1},s=function e(t,r,o,n,i,s,c,d,u,p,f,m){var h=t;if("function"==typeof c)h=c(r,h);else if(h instanceof Date)h=p(h);else if(null===h){if(n)return s&&!m?s(r,l.encoder):r;h=""}if("string"==typeof h||"number"==typeof h||"boolean"==typeof h||a.isBuffer(h)){if(s){return[f(m?r:s(r,l.encoder))+"="+f(s(h,l.encoder))]}return[f(r)+"="+f(String(h))]}var g=[];if(void 0===h)return g;var v;if(Array.isArray(c))v=c;else{var y=Object.keys(h);v=d?y.sort(d):y}for(var b=0;b<v.length;++b){var A=v[b];i&&null===h[A]||(g=Array.isArray(h)?g.concat(e(h[A],o(r,A),o,n,i,s,c,d,u,p,f,m)):g.concat(e(h[A],r+(u?"."+A:"["+A+"]"),o,n,i,s,c,d,u,p,f,m)))}return g};e.exports=function(e,t){var r=e,i=t?a.assign({},t):{};if(null!==i.encoder&&void 0!==i.encoder&&"function"!=typeof i.encoder)throw new TypeError("Encoder has to be a function.");var c=void 0===i.delimiter?l.delimiter:i.delimiter,d="boolean"==typeof i.strictNullHandling?i.strictNullHandling:l.strictNullHandling,u="boolean"==typeof i.skipNulls?i.skipNulls:l.skipNulls,p="boolean"==typeof i.encode?i.encode:l.encode,f="function"==typeof i.encoder?i.encoder:l.encoder,m="function"==typeof i.sort?i.sort:null,h=void 0!==i.allowDots&&i.allowDots,g="function"==typeof i.serializeDate?i.serializeDate:l.serializeDate,v="boolean"==typeof i.encodeValuesOnly?i.encodeValuesOnly:l.encodeValuesOnly;if(void 0===i.format)i.format=o.default;else if(!Object.prototype.hasOwnProperty.call(o.formatters,i.format))throw new TypeError("Unknown format option provided.");var y,b,A=o.formatters[i.format];"function"==typeof i.filter?(b=i.filter,r=b("",r)):Array.isArray(i.filter)&&(b=i.filter,y=b);var w=[];if("object"!=typeof r||null===r)return"";var O;O=i.arrayFormat in n?i.arrayFormat:"indices"in i?i.indices?"indices":"repeat":"indices";var _=n[O];y||(y=Object.keys(r)),m&&y.sort(m);for(var k=0;k<y.length;++k){var C=y[k];u&&null===r[C]||(w=w.concat(s(r[C],C,_,d,u,p?f:null,b,m,h,g,A,v)))}var x=w.join(c),M=!0===i.addQueryPrefix?"?":"";return x.length>0?M+x:""}},876:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(853),n=a(o),i=r(109),l=a(i),s=function(){return new l.default(function(e,t){var r=document.createElement("script");r.type="text/javascript",r.src="http://api.map.baidu.com/api?v=2.0&ak=K52pNzWT61z1EHvdZptaSmlPRc7mKbjC&callback=init",r.onerror=t,document.head.appendChild(r),window.init=function(){e(BMap)}})},c=function(){return new l.default(function(e,t){var r=document.createElement("script");r.type="text/javascript",r.src="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.js",r.onerror=t,document.head.appendChild(r);var a=document.createElement("link");a.rel="stylesheet",a.href="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css",document.head.appendChild(a),r.onload=r.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(console.log("load DrawingManager ok"),e(BMapLib)),r.onload=r.onreadystatechange=null}})};t.default={data:function(){return{map:"",marker:"",keyword:"",subradius:this.radius?this.radius:"",lng:this.longitude,lat:this.latitude,desc:this.description,poly:this.polygon,mapStyle:{width:"100%",height:this.mapHeight+"px",geoc:""},styleOptions:{fillColor:"blue",strokeColor:"red",strokeWeight:1,fillOpacity:.3,strokeOpacity:.3},drawingManager:""}},props:{mapHeight:{type:Number,default:500},longitude:{type:String},latitude:{type:String},description:{type:String,default:""},radius:{type:String,default:"100"},polygon:{type:String,default:"[]"},showtype:{type:String,default:""},radiusLabel:{type:String,default:"还车半径"}},created:function(){},mounted:function(){var e=this;this.$nextTick(function(){var t=this;s().then(function(r){t.map=new r.Map("mapimpl",{enableMapClick:!1}),t.map.enableScrollWheelZoom(),t.map.enableContinuousZoom(),t.showtype&&"polyon"==t.showtype?e.initPoly():e.initClick(),e.addControl()}).catch(function(e){console.log("map impl error")})})},methods:{addControl:function(){var e=this,t=new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT}),r=new BMap.NavigationControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT,type:BMAP_NAVIGATION_CONTROL_SMALL});e.map.addControl(r),setTimeout(function(){e.map.addControl(t)},1e3)},initClick:function(){var e=this;this.map.addEventListener("click",function(t){var r=(t.point,new BMap.Point(t.point.lng,t.point.lat));e.marker=new BMap.Marker(r),e.marker.enableDragging(),e.lng=t.point.lng,e.lat=t.point.lat,e.pointInmap()}),e.remark(e.lng,e.lat,e.subradius)},schCity:function(){var e=this,t=this.keyword,r=e.map,a=new BMap.LocalSearch(r);a.enableAutoViewport(),a.setSearchCompleteCallback(function(t){var r=t.getPoi(0);e.lng=r.point.lng,e.lat=r.point.lat,setTimeout(function(){e.map.centerAndZoom(r.point,15)},500)}),a.search(t)},remark:function(e,t,r,a){this.keyword="";var o=this;o.lng=e||"",o.lat=t||"",o.subradius=r||"","[]"!=a&&a?(o.poly=a,o.polygonInmap()):o.pointInmap()},polygonInmap:function(){var e=this,t=[],r=[];try{t=JSON.parse(e.poly)}catch(e){console.log("error:parse poly arr"+e)}t.forEach(function(e){var t=new BMap.Point(e.lng,e.lat);r.push(t)});var a=new BMap.Polygon(r,e.styleOptions);e.map.clearOverlays(),e.map.addOverlay(a);var o=new BMap.ContextMenu;o.addItem(new BMap.MenuItem("删除多边形",function(){e.map.removeOverlay(a)})),a.addContextMenu(o),setTimeout(function(){e.map.centerAndZoom(r[0],15)},500)},pointInmap:function(){function e(e){t.lng=e.point.lng,t.lat=e.point.lat,t.pointInmap()}var t=this;if(!t.lng||!t.lat)return t.remarkCity(),void console.log("no lat or lng");var r=new BMap.Point(t.lng,t.lat);t.marker=new BMap.Marker(r),t.marker.enableDragging(),t.marker.removeEventListener("dragend",e),t.marker.addEventListener("dragend",e),setTimeout(function(){t.map.centerAndZoom(r,15)},500);var a=new BMap.Geocoder,o=new BMap.Circle(r,t.subradius,t.styleOptions);a.getLocation(r,function(e){var r=e.addressComponents,a=r.province+", "+r.city+", "+r.district+", "+r.street+", "+r.streetNumber;t.desc=a;var o=new BMap.Label(a,{offset:new BMap.Size(20,-10)});t.marker.setLabel(o),t.$emit("change",{lng:t.lng,lat:t.lat,radius:t.subradius},a)}),t.map.clearOverlays(),t.map.addOverlay(o),t.map.addOverlay(t.marker)},changeradius:function(){var e=this;e.lng&&e.lat&&this.remark(e.lng,e.lat,e.subradius),this.$emit("change",{lng:e.lng,lat:e.lat,radius:e.subradius},e.desc)},remarkCity:function(){var e=this,t=new BMap.LocalCity;e.map.clearOverlays(),t.get(function(t){var r=t.name;e.map.setCenter(r),setTimeout(function(){e.map.centerAndZoom(r,15)},500)})},initPoly:function(){var e=this;c().then(function(){var t=new BMapLib.DrawingManager(e.map,{isOpen:!1,enableDrawingTool:!0,drawingToolOptions:{anchor:BMAP_ANCHOR_TOP_RIGHT,offset:new BMap.Size(5,5),drawingModes:[BMAP_DRAWING_CIRCLE,BMAP_DRAWING_POLYGON]},circleOptions:e.styleOptions,polylineOptions:e.styleOptions,polygonOptions:e.styleOptions,rectangleOptions:e.styleOptions});e.remark(e.longitude,e.latitude,e.radius,e.polygon);var r=null;t.addEventListener("overlaycomplete",function(a){if(console.log("overlaycomplete"),e.map.clearOverlays(),r=a.overlay,e.map.addOverlay(a.overlay),t.close(),"circle"==a.drawingMode){var o=parseInt(r.getRadius()),i=r.getCenter();e.remark(i.lng,i.lat,o)}else if("polygon"==a.drawingMode){var l=r.getPath(),s=(0,n.default)(l);e.$emit("change",{lng:"",lat:"",radius:""},"",s);var c=new BMap.ContextMenu;c.addItem(new BMap.MenuItem("删除多边形",function(){e.map.removeOverlay(r)})),r.addContextMenu(c),r.enableEditing(),r.addEventListener("lineupdate",function(t){l=r.getPath(),s=(0,n.default)(l),e.$emit("change",{lng:"",lat:"",radius:""},"",s)})}})}).catch(function(e){console.log("e:"+e)})}}}}});